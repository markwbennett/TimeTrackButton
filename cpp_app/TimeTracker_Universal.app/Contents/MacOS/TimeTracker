#!/bin/bash

# Get the directory containing this script
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
APP_DIR="$(dirname "$(dirname "$SCRIPT_DIR")")"

# Completely clear Qt environment to avoid any conflicts
unset QT_PLUGIN_PATH
unset QT_QPA_PLATFORM_PLUGIN_PATH
unset QTDIR
unset QT_SELECT
unset QML2_IMPORT_PATH
unset QT_QUICK_CONTROLS_STYLE
unset QT_LOGGING_RULES
unset QT_SCALE_FACTOR
unset QT_AUTO_SCREEN_SCALE_FACTOR

# Clear all library paths that might cause conflicts
unset DYLD_LIBRARY_PATH
unset DYLD_FRAMEWORK_PATH
unset DYLD_FALLBACK_LIBRARY_PATH
unset DYLD_FALLBACK_FRAMEWORK_PATH

# Set up isolated environment pointing only to our bundled libraries
export QT_PLUGIN_PATH="$APP_DIR/Contents/PlugIns"
export QT_QPA_PLATFORM_PLUGIN_PATH="$APP_DIR/Contents/PlugIns/platforms"

# Ensure we use our bundled frameworks/libraries first
export DYLD_FRAMEWORK_PATH="$APP_DIR/Contents/Frameworks"
export DYLD_LIBRARY_PATH="$APP_DIR/Contents/Libraries:$APP_DIR/Contents/Frameworks"

# Disable Qt's plugin cache to force fresh discovery
export QT_NO_GLIB=1

# Run the actual application
exec "$SCRIPT_DIR/TimeTracker_real" "$@"
